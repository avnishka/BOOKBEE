
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}BookBee{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; font-family: 'Poppins', sans-serif; background-color: #FAFAFA; }
        a { text-decoration: none; color: inherit; }

        /* --- 1. OLX STYLE LEND BUTTON (Your Design) --- */
        .lend-btn-container {
            position: relative;
            display: inline-block;
        }
        
        .lend-btn {
            background: white;
            border-top: 5px solid #FFC83D; /* Yellow top border */
            border-bottom: 5px solid #2E7D32; /* Green bottom border */
            border-left: 5px solid #FFC83D;
            border-right: 5px solid #2E7D32;
            border-radius: 30px;
            padding: 5px 25px;
            font-weight: 800;
            color: #4A2C1A;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .lend-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .plus-icon { font-size: 1.2rem; font-weight: 900; }

        /* --- 2. SEARCH BAR STYLES --- */
        .search-form {
            display: flex; 
            align-items: center; 
            background: #F5F5F5; 
            border-radius: 50px; 
            padding: 5px 15px; 
            border: 1px solid #E0E0E0; 
            width: 100%; 
            max-width: 750px; /* Made wider for new filters */
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);
        }

        .nav-select, .city-trigger-btn {
            background: transparent;
            border: none;
            padding: 10px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            border-right: 1px solid #ddd;
            outline: none;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 8px 15px;
            outline: none;
            font-size: 1rem;
            font-family: inherit;
        }

        .search-btn {
            background: #2E7D32;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
        }
        .search-btn:hover { background: #1B5E20; }

        /* --- 3. CITY MODAL STYLES (Friend's Feature) --- */
        .city-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(2px);
        }

        .city-modal {
            background: #fff;
            width: 600px;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }

        .city-modal-header {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .city-search-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-size: 1rem;
            outline: none;
        }
        .city-search-input:focus { border-color: #2E7D32; }

        .close-btn {
            border: none;
            background: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .detect-location {
            color: #d32f2f;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-block;
        }

        .city-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .city-item {
            text-align: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            background: #f9f9f9;
            transition: 0.2s;
            font-size: 0.9rem;
            color: #333;
        }

        .city-item:hover {
            background: #E8F5E9;
            color: #2E7D32;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <nav style="background: white; padding: 10px 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; display: flex; align-items: center; justify-content: space-between;">
        
        <a href="{% url 'home' %}" style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 1.6rem; font-weight: 800; color: #2E7D32; letter-spacing: -1px;">BookBee</span>
            <span style="font-size: 1.6rem;">üêù</span>
        </a>

        <div style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 20px; margin: 0 20px;">
            
            <form action="{% url 'home' %}" method="GET" class="search-form">
                
                <select name="genre" class="nav-select">
                    <option value="">üìö Genre</option>
                    <option value="Fiction">Fiction</option>
                    <option value="Non-Fiction">Non-Fiction</option>
                    <option value="Sci-Fi">Sci-Fi</option>
                    <option value="Mystery">Mystery</option>
                    <option value="Romance">Romance</option>
                    <option value="Academic">Academic</option>
                </select>

                <button type="button" class="city-trigger-btn" id="openCityModal">
                    <span id="selectedCityText">üìç Location</span>
                </button>
                <input type="hidden" name="location" id="selectedCityInput">

                <select name="sort" class="nav-select">
                    <option value="">üí∞ Price</option>
                    <option value="low_to_high">Low to High</option>
                    <option value="high_to_low">High to Low</option>
                </select>

                <input type="text" name="q" placeholder="Search books..." class="search-input" value="{{ request.GET.q }}">

                <button type="submit" class="search-btn">üîç</button>
            </form>

            <div class="lend-btn-container">
                <a href="{% url 'add_book' %}" class="lend-btn">
                    <span class="plus-icon">+</span> LEND
                </a>
            </div>

        </div>

        <div style="display: flex; gap: 20px; align-items: center;">
            {% if user.is_authenticated %}
                <a href="{% url 'profile' %}" style="font-weight: 600; color: #4A2C1A; display: flex; align-items: center; gap: 5px;">
                    <span style="font-size: 1.2rem;">üë§</span> 
                </a>
                <form action="{% url 'logout' %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" style="background: white; border: 2px solid #ddd; padding: 6px 15px; border-radius: 20px; font-weight: bold; color: #666; cursor: pointer; font-size: 0.8rem;">Logout</button>
                </form>
            {% else %}
                <a href="{% url 'login' %}"><button style="background: #2E7D32; color: white; border: none; padding: 8px 20px; border-radius: 25px; font-weight: bold; cursor: pointer;">Login</button></a>
            {% endif %}
        </div>
    </nav>

    <div style="background: #FFC83D; color: #4A2C1A; text-align: center; padding: 5px; font-weight: bold; font-size: 0.9rem;">
        üìö Free Books Available ‚Äì Borrow Knowledge, Not Cost!
    </div>

    <div style="min-height: 80vh;">
        {% if messages %}
            {% for message in messages %}
            <div style="background: #E8F5E9; color: #2E7D32; padding: 10px; text-align: center; font-weight: bold; border-bottom: 1px solid #C8E6C9;">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
        
        {% block content %}
        {% endblock %}
    </div>

    <footer style="background: #FFF8E1; padding: 20px; text-align: center; margin-top: 50px;">
        <p style="color: #4A2C1A; margin: 0;">BookBee üêù ‚Äî Share books, Save money, Spread knowledge</p>
    </footer>

    <div class="city-modal-overlay" id="cityModal">
        <div class="city-modal">
            <div class="city-modal-header">
                <input type="text" placeholder="Search for your city..." class="city-search-input" id="citySearchInput">
                <button class="close-btn" id="closeCityModal">‚úï</button>
            </div>

            <p class="detect-location" onclick="detectUserLocation()">üìç Detect my location</p>

            <h4 style="margin-top:0; color:#444;">Popular Cities</h4>
            <div class="city-grid" id="cityGrid">
                <div class="city-item">Delhi</div>
                <div class="city-item">Mumbai</div>
                <div class="city-item">Bangalore</div>
                <div class="city-item">Hyderabad</div>
                <div class="city-item">Chennai</div>
                <div class="city-item">Kolkata</div>
                <div class="city-item">Pune</div>
                <div class="city-item">Noida</div>
                <div class="city-item">Gurgaon</div>
                <div class="city-item">Jaipur</div>
                <div class="city-item">Lucknow</div>
                <div class="city-item">Chandigarh</div>
            </div>
        </div>
    </div>

    <script>
        const modal = document.getElementById("cityModal");
        const openBtn = document.getElementById("openCityModal");
        const closeBtn = document.getElementById("closeCityModal");
        const cityItems = document.querySelectorAll(".city-item");
        const selectedCityText = document.getElementById("selectedCityText");
        const selectedCityInput = document.getElementById("selectedCityInput");
        const searchInput = document.getElementById("citySearchInput");

        // Open/Close Modal
        openBtn.onclick = () => { modal.style.display = "flex"; };
        closeBtn.onclick = () => { modal.style.display = "none"; };

        // Close if clicked outside
        window.onclick = (e) => {
            if (e.target == modal) {
                modal.style.display = "none";
            }
        };

        // Handle City Selection
        cityItems.forEach(city => {
            city.onclick = () => {
                const cityName = city.innerText;
                selectedCityText.innerText = "üìç " + cityName;
                selectedCityInput.value = cityName; // Updates the hidden input
                modal.style.display = "none";
                
                // Optional: Auto-submit form when city is picked
                // openBtn.closest("form").submit(); 
            };
        });

        // Filter Cities in Modal
        searchInput.addEventListener("keyup", () => {
            const value = searchInput.value.toLowerCase();
            cityItems.forEach(city => {
                city.style.display =
                    city.innerText.toLowerCase().includes(value) ? "block" : "none";
            });
        });

        // Basic Geo-Location (Optional enhancement)
        function detectUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position){
                    alert("Location detected! (This would auto-fill in a real app)");
                    // logic to reverse geocode lat/lon to city name goes here
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
    </script>

</body>
</html>
